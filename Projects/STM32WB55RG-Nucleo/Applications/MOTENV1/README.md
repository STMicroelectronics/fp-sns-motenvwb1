# MOTENV1_OTA Application Description for STM32WB55xx with X-NUCLEO-IKS01A3 and  X-NUCLEO-53L3A2 expansion boards

This firmware package includes Components Device Drivers, Board Support Package
and example application for the following STMicroelectronics elements:
 - P-NUCLEO-WB55 Nucleo-68 board with STM32WB55 MCU supporting Bluetooth™ 5 and 802.15.4 connectivity
 - X-NUCLEO-IKS01A3 Expansion board for six MEMS sensor devices:
     - HTS221, LIS2DW12, LIS2MDL, LPS22HH, LSM5DSO
 - X-NUCLEO-53L3A2  Multi-targets ranging sensor expansion board based on VL53L3CX for STM32 Nucleo (optional).
 - MotionFX (iNEMOEngine PRO) suite uses advanced algorithms to integrate outputs
 from multiple MEMS sensors in a smartway, independent of environmental conditions,
 to reach optimal performance. Real-time motion-sensor data fusion is set to significantly
 improve the user experience, increasing accuracy, resolution, stability and response time.
 - MotionAR software provides real-time activity recognition data using MEMS accelerometer sensor
 - MotionCP software provides carry Position recognition data using MEMS accelerometer sensor
 - MotionGR software provides Gesture recognition data using MEMS accelerometer sensor
 - MotionPM software provides Pedometer recognition data using MEMS accelerometer sensor
 - MotionID software provides real-time Motion Intensity recognition data using MEMS accelerometer sensor


The Example application initializes all the Components and Library creating 3 Custom Bluetooth services:
 - The first service exposes all the HW characteristics related to MEMS and time-of-flight sensor devices: Temperature, Humidity,
   Pressure, Magnetometer, Gyroscope and Accelerometer, ToF Objects Distance, LED status
 - The second service exposes the SW characteristic: the quaternions generated by the MotionFX library 
   in short precision, the activity recognized using the MotionAR algorithm, the carry position
   recognized using the MotionCP algorithm, the Gesture recognized using the MotionGR algorithm,
   the Motion Intensity recognized using the MotionID algorithm and the Steps and frequency with MotionPM algorithm
 - The last Service is used for configuration purpose
 
For debug purposes, the example application allows the user to control the initialization phase via UART.
Launch a terminal application and set the UART port to 115200 bps, 8 bit, No Parity, 1 stop bit.
For this, in the file app_conf.h change the define CFG_DEBUG_APP_TRACE from 0 to 1.
 
This example must be used with the related ST BLE Sensor Android/iOS application available on Play/itune store,
in order to read the sent information by Bluetooth Low Energy protocol

## Issue

Related to Keil µVision 5:
 - If the constant CFG_DEBUG_APP_TRACE is egual to 1 for enabling the printf, the application doesnt't work
 
## Hardware and Software environment

 - This example runs on X-NUCLEO-IKS01A3 Sensor expansion board attached to P-NUCLEO-WB55RG.Nucleo board.
    
 - This example must be used with the ST BLE Sensor Android/iOS application available on Play/iTunes store,
   in order to read the sent information by Bluetooth Low Energy protocol.
	
 - Inside the Binary Directory there are the following binaries:
   - MOTENV1_IKS01A3_WB55RG.bin

## Dependencies

STM32Cube packages:
  - STM32ubeWB V1.14.0
  
X-CUBE packages:
  - X-CUBE-MEMS1 V9.2.0
  - X-CUBE-TOF1 V3.1.0

## How to use it ?

This package contains projects for 3 IDEs viz. IAR, Keil µVision 5 and Integrated Development Environment for STM32. 
In order to make the  program work, you must do the following:
 - WARNING: before opening the project with any toolchain be sure your folder
   installation path is not too in-depth since the toolchain may report errors
   after building.

For IAR:
 - Open IAR toolchain (this firmware has been successfully tested with Embedded Workbench V9.20.1).
 - Open the IAR project file EWARM\Project.eww
 - Rebuild all files 

For Keil µVision 5:
 - Open Keil µVision 5 toolchain (this firmware has been successfully tested with MDK-ARM Professional Version: 5.37.0).
 - Check the stm32wb55xx_flash_cm4.sct is included in the MDK-ARM folder (a copy is available in extSettings/MDK-ARM folder).
 - Open the µVision project file MDK-ARM\MOTENV1_IKS01A3_WB55RG_OTA.uvprojx
 - Rebuild all files.

For Integrated Development Environment for STM32:
 - Open STM32CubeIDE (this firmware has been successfully tested with Version 1.10.1).
 - Set the default workspace proposed by the IDE (please be sure that there are not spaces in the workspace path).
 - Press "File" -> "Import" -> "Existing Projects into Workspace"; press "Browse" in the "Select root directory" and choose the path where the CubeIDE
   project is located (it should be STM32CubeIDE). 
 - Rebuild all files

## CubeMX
The hardware and software configuration, and the projects (for EWARM, MDK-ARM and CubeIDE toolchains) generation have been done with STM32CubeMX.
The project folder also includes the MOTENV1_IKS01A3_WB55RG.ioc file to be opened with STM32CubeMX V6.6.1 or higher allowing the user to check and or/change system configuration.
Notice that when regenerating the projects with CubeMX you should have the .extSettings file specifying additional project settings at the same level of the MOTENV1_IKS01A3_WB55RG.ioc file
Since Middleware libraries providing MEMS features come with different build for different toolchains, you need to use specific .extSetting file.
After the code generation the constant CFG_DEBUG_APP_TRACE is egual to 1.

For IAR:
 - .extSettings is included in extSettings/EWARM folder
 
For µVision:
 - .extSettings is included in extSettings/MDK-ARM folder

For CubeIDE:
 - .extSettings is included in extSettings/CubeIDE folder




