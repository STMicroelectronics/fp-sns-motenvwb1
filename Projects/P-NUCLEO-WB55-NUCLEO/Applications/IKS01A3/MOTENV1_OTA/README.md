## <b>MOTENV1_OTA Application Description</b>

Application for NUCLEO-WB55RG (or P-NUCLEO-WB55) with X-NUCLEO-IKS01A3 and X-NUCLEO-53L3A2 (optional) expansion boards.

Example Description:

The MOTENV1 is an STM32Cube function pack which lets you connect your IoT node to a smartphone via BLE and use a suitable Android™ or iOS™ like the ST BLE Sensor app to view real-time environmental sensor data, motion sensor data and time-of-flight sensors data.
The package also enables advanced functionality such as sensor data fusion and accelerometer-based real-time activity recognition, carry position, gesture recognition, pedometer, motion Intensity, campass and objects distance.

The application supports firmware update (FOTA).

This package, together with the suggested combination of STM32WB and ST devices can be used to develop specific wearable applications, or smart things applications in general.


The Example application initizializes all the Components and Library creating 3 Custom Bluetooth services:

 - The first service exposes all the HW characteristics related to MEMS and time-of-flight sensor devices: Temperature, Humidity,
   Pressure, Magnetometer, Gyroscope and Accelerometer, ToF Objects Distance, LED status
 - The second service exposes the SW characteristic: the quaternions generated by the MotionFX library 
   in short precision, the activity recognized using the MotionAR algorithm, the carry position
   recognized using the MotionCP algorithm, the Gesture recognized using the MotionGR algorithm,
   the Motion Intensity recognized using the MotionID algorithm and the Steps and frequency with MotionPM algorithm
 - The last Service is used for configuration purpose
 
The example application allows the user to control the initialization phase via UART.
Launch a terminal application and set the UART port to 115200 bps, 8 bit, No Parity, 1 stop bit.
For this, in the file app_conf.h change the define CFG_DEBUG_APP_TRACE from 0 to 1.
 
This example must be used with the related ST BLE Sensor Android (Version 4.20.0 or higher) or iOS (Version 4.20.0 or higher) application available on Play/itune store,
in order to read the sent information by Bluetooth Low Energy protocol

### <b>Very Iimportant</b>

The implementation allow the Firmware-Over-The-Air (FOTA).
To support OTA you need:
 
 1) to flash BLE_Ota_reference.hex from 0x8000000 at the beginning of the FLASH (address 0x08000000)
 2) flash user application from 0x8007000

### <b>Issue</b>

After code generation from STM32CubeMX software before building:
 - for IAR, Keil and STM32CubeIDE replace the linker scripts with the scripts in the folder LinkerScript
 - for Keil, open the "Options for Target" and in the tab "Target" set start= 0x8007000 and sixe= 0x79000. 

### <b>Keywords</b>

BLE, SPI, UART, MEMS

### <b>Hardware and Software environment</b>

  - This example runs on STM32WB Nucleo devices with:
	- Motion MEMS and environmental sensor expansion board (X-NUCLEO-IKS01A3) for four MEMS sensor devices:
	  - HTS221, LPS22HH, STTS751, LSM6DSO, LIS2MDL, LIS2DW12
	- Multi-targets ranging sensor expansion board X-NUCLEO-53L3A2 based on VL53L3CX for STM32 Nucleo.
  - This example has been tested with STMicroelectronics:
    - NUCLEO-WB55RG (or P-NUCLEO-WB55) board
	
ADDITIONAL_BOARD : X-NUCLEO-53L3A2 https://www.st.com/en/evaluation-tools/x-nucleo-53l3a2.html

ADDITIONAL_COMP : VL53L3CX https://www.st.com/en/imaging-and-photonics-solutions/vl53l3cx.html

ADDITIONAL_BOARD : X-NUCLEO-IKS01A3 https://www.st.com/en/ecosystems/x-nucleo-iks01a3.html

ADDITIONAL_COMP : LSM6DSO https://www.st.com/content/st_com/en/products/mems-and-sensors/inemo-inertial-modules/lsm6dso.html

ADDITIONAL_COMP : LIS2DW12 https://www.st.com/content/st_com/en/products/mems-and-sensors/accelerometers/lis2dw12.html

ADDITIONAL_COMP : LIS2MDL https://www.st.com/content/st_com/en/products/mems-and-sensors/e-compasses/lis2mdl.html

ADDITIONAL_COMP : LPS22HH https://www.st.com/content/st_com/en/products/mems-and-sensors/pressure-sensors/lps22hh.html

ADDITIONAL_COMP : HTS221 https://www.st.com/content/st_com/en/products/mems-and-sensors/humidity-sensors/hts221.html

ADDITIONAL_COMP : STTS751 https://www.st.com/content/st_com/en/products/mems-and-sensors/temperature-sensors/stts751.html

### <b>Dependencies</b>

STM32Cube packages:

  - STM32WBxx drivers from STM32ubeWB V1.17.0
  
X-CUBE packages:

  - X-CUBE-MEMS1 V10.0.0
  - X-CUBE-TOF1 V3.3.0

### <b>How to use it?</b>

This package contains projects for 3 IDEs viz. IAR, Keil µVision 5 and Integrated Development Environment for STM32. 
In order to make the  program work, you must do the following:

 - WARNING: before opening the project with any toolchain be sure your folder
   installation path is not too in-depth since the toolchain may report errors
   after building.

For IAR:

 - Open IAR toolchain (this firmware has been successfully tested with Embedded Workbench V9.20.1).
 - Open the IAR project file EWARM/Project.eww
 - Rebuild all files

For Keil µVision 5:

 - Open Keil µVision 5 toolchain (this firmware has been successfully tested with MDK-ARM Professional Version: 5.37.0).
 - Open the µVision project file MDK-ARM/MOTENV1.uvprojx
 - Rebuild all files
 
For Integrated Development Environment for STM32:

 - Open STM32CubeIDE (this firmware has been successfully tested with Version 1.12.1).
 - Set the default workspace proposed by the IDE (please be sure that there are not spaces in the workspace path).
 - Press "File" -> "Import" -> "Existing Projects into Workspace"; press "Browse" in the "Select root directory" and choose the path where the System
   Workbench project is located (it should be STM32CubeIDE). 
 - Rebuild all files

### <b>Author</b>

SRA Application Team

### <b>License</b>

Copyright (c) 2023 STMicroelectronics.
All rights reserved.

This software is licensed under terms that can be found in the LICENSE file
in the root directory of this software component.
If no LICENSE file comes with this software, it is provided AS-IS.